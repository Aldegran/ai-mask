# Настройка Raspberry Pi 4B для AIMask

## 1. Подходит ли Raspberry Pi 4B?

**Да, вполне.** 
Для нашей задачи (клиент для работы с камерой, микрофоном, воспроизведением звука и отправкой данных на сервер/API) производительности Raspberry Pi 4B достаточно.
*   **Node.js сервер:** RPi 4 отлично тянет Node.js.
*   **Piper (TTS):** Работает на RPi 4 быстро (генерирует быстрее реального времени).
*   **Видео:** Если мы транслируем видео или делаем простую обработку, мощностей хватит.
*   **LLM (Gemini):** Так как мы используем облачный API, нагрузка ложится на Google, а не на Pi.

*Нюанс:* RPi 5 была бы быстрее для "тяжелых" локальных задач, но для старта RPi 4 — отличный выбор.

---

## 2. Установка ОС (Raspberry Pi OS Lite) через Windows

Поскольку у нас серверное приложение (без монитора), лучше всего подойдет версия **Lite** (без графического интерфейса). Она потребляет меньше ресурсов.

### Что понадобится:
*   MicroSD карта (минимум 16GB, лучше 32GB+).
*   Картридер для ПК.
*   Программа **Raspberry Pi Imager** (скачать с [raspberrypi.com/software](https://www.raspberrypi.com/software/)).

### Инструкция:
1.  Вставьте SD-карту в компьютер.
2.  Запустите **Raspberry Pi Imager**.
3.  **Choose Device (Устройство):** Выберите `Raspberry Pi 4`.
4.  **Choose OS (Операционная система):** 
    *   `Raspberry Pi OS (other)` -> `Raspberry Pi OS Lite (64-bit)`.
    *   *Важно выбрать 64-bit для совместимости с современными пакетами Node.js и Piper.*
5.  **Choose Storage (Хранилище):** Выберите вашу SD-карту.
6.  **Настройка (Самый важный этап!):**
    *   Нажмите **Next**. Программа спросит "Would you like to apply OS customisation settings?". Нажмите **EDIT SETTINGS** (Редактировать настройки).
    *   **General (Общие):**
        *   [x] **Set hostname:** `aimask` (или любое другое имя).
        *   [x] **Set username and password:** Создайте пользователя (например, `pi`) и надежный пароль.
        *   [x] **Configure Wireless LAN:** Введите имя (SSID) и пароль от **Wi-Fi точки доступа**, которую раздает ваш Windows компьютер.
        *   [x] **Set locale settings:** Time zone (Europe/Moscow или ваша), Keyboard layout (us).
    *   **Services (Службы):**
        *   [x] **Enable SSH:** Выберите `Use password authentication`.
7.  Нажмите **SAVE**, затем **YES** (начнется запись).
8.  После завершения вставьте карту в Raspberry Pi и включите питание.

---

## 3. Подключение системы и SSH

1.  Убедитесь, что Raspberry Pi подключилась к Wi-Fi точке доступа на Windows. В настройках мобильного хот-спота Windows можно посмотреть список подключенных устройств и их **IP-адрес**.
2.  Откройте терминал в VS Code (Ctrl+Shift+\`) на Windows.
3.  Подключитесь по SSH:
    ```bash
    ssh pi@192.168.137.X
    # Замените pi на имя пользователя, а 192.168.137.X - на IP адрес Raspberry Pi.
    # Если hostname работает (и установлен Bonjour/mDNS), можно пробовать:
    ssh pi@aimask.local
    ```
4.  Введите пароль.
5.  Теперь **я (AI)** смогу видеть вывод терминала, если вы будете запускать команды в этой SSH-сессии внутри VS Code.

---

## 4. Настройка рабочего окружения (VS Code Remote vs Samba)

Я настоятельно **не рекомендую Samba** для разработки кода (это медленно и неудобно для отладки).
Лучший способ — использовать расширение **Remote - SSH** для VS Code.

### Как настроить Remote - SSH (Рекомендуется):
1.  В VS Code на Windows установите расширение: `Remote - SSH` (от Microsoft).
2.  Нажмите `F1`, введите `Remote-SSH: Connect to Host...`.
3.  Введите `pi@192.168.137.X` (или `pi@aimask.local`).
4.  VS Code откроет **новое окно**, которое работает *прямо внутри* Raspberry Pi.
5.  В этом окне откройте папку проекта (вам нужно будет склонировать репозиторий туда или скопировать файлы).
    *   *Совет:* Можно просто перетащить папку `server` из Windows в файловый проводник VS Code в Remote-сессии.
6.  Терминал в этом окне будет терминалом Raspberry Pi. Я смогу редактировать файлы и запускать команды напрямую там.

### Установка Node.js на Raspberry Pi (в терминале SSH):
```bash
# Установка Node.js 20 (LTS)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# Проверка
node -v
npm -v

# Установка зависимостей для сборки (может понадобиться)
sudo apt-get install -y build-essential git
```

---

## 5. Подключение оборудования

### USB Аудиокарта
1.  Подключите USB-карту.
2.  Проверьте, видит ли система устройства воспроизведения и записи:
    ```bash
    aplay -l   # Список устройств воспроизведения
    arecord -l # Список устройств записи
    ```
3.  Обычно USB-аудио становится `card 1`.
4.  Для настройки громкости используйте `alsamixer` (нажмите F6 для выбора карты).

### Камера
Если используется **USB Webcam**:
1.  Просто подключите.
2.  Проверьте наличие устройства: `ls /dev/video*`.
3.  Установите FFMpeg: `sudo apt install ffmpeg`.

Если используется **Raspberry Pi Camera (CSI шлейф)**:
1.  В современных ОС используется `libcamera`.
2.  Возможно, потребуется включить Legacy поддержку, если ваш софт старый (но для Node.js лучше использовать современные инструменты).
3.  Проверка: `libcamera-hello` (должна показать превью на подключенном мониторе или выдать инфо без ошибок).

---

## План действий

1.  Запишите образ на карту.
2.  Подключитесь по SSH.
3.  Настройте VS Code Remote - SSH.
4.  Скопируйте туда папку `server`.
5.  Запустите `npm install`.
6.  Попробуем запустить тестовые скрипты.
